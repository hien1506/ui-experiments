/**
 * Auto-generates the showcase items registry by scanning component folders.
 *
 * This script scans app/components/showcase/ for directories containing
 * Component.tsx and metadata.ts files, then generates items.ts with all imports.
 *
 * Usage: npx tsx scripts/generate-showcase-items.ts
 */

import fs from "node:fs";
import path from "node:path";

const SHOWCASE_DIR = path.join(process.cwd(), "app/components/showcase");
const OUTPUT_FILE = path.join(SHOWCASE_DIR, "items.ts");

// Files that indicate a valid showcase component folder
const REQUIRED_FILES = ["Component.tsx", "metadata.ts"];

// Files/folders to ignore when scanning
const IGNORE_LIST = new Set([
  "registry.ts",
  "items.ts",
  "ShowcaseWrapper.tsx",
  "index.ts",
]);

function getComponentFolders(): string[] {
  const entries = fs.readdirSync(SHOWCASE_DIR, { withFileTypes: true });

  return entries
    .filter((entry) => {
      if (!entry.isDirectory()) return false;
      if (IGNORE_LIST.has(entry.name)) return false;

      // Check if folder has required files
      const folderPath = path.join(SHOWCASE_DIR, entry.name);
      return REQUIRED_FILES.every((file) =>
        fs.existsSync(path.join(folderPath, file)),
      );
    })
    .map((entry) => entry.name)
    .sort(); // Alphabetical order for consistent output
}

function generateItemsFile(folders: string[]): string {
  const imports = folders
    .map(
      (name) =>
        `import ${name}Component from "./${name}/Component";\n` +
        `import { metadata as ${name}Metadata } from "./${name}/metadata";`,
    )
    .join("\n");

  const items = folders
    .map(
      (name) =>
        `  {\n    Component: ${name}Component,\n    metadata: ${name}Metadata,\n  },`,
    )
    .join("\n");

  return `/**
 * AUTO-GENERATED FILE - DO NOT EDIT MANUALLY
 * Generated by: scripts/generate-showcase-items.ts
 *
 * To add a new component:
 * 1. Create a folder in app/components/showcase/YourComponent/
 * 2. Add Component.tsx and metadata.ts
 * 3. Run: npm run generate:showcase
 */

import type { ShowcaseItem } from "./registry";

${imports}

export const SHOWCASE_ITEMS: ShowcaseItem[] = [
${items}
];
`;
}

function main() {
  console.log("üîç Scanning for showcase components...");

  const folders = getComponentFolders();

  if (folders.length === 0) {
    console.log("‚ö†Ô∏è  No component folders found");
    return;
  }

  console.log(`üì¶ Found ${folders.length} components: ${folders.join(", ")}`);

  const content = generateItemsFile(folders);
  fs.writeFileSync(OUTPUT_FILE, content, "utf-8");

  console.log(`‚úÖ Generated ${path.relative(process.cwd(), OUTPUT_FILE)}`);
}

main();
